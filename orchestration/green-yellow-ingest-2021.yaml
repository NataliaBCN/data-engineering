id: taxi-ingest-2021
namespace: nyc_taxi
description: >
  Flow to ingest green and yellow taxi data for 2021 (Jan-Jul)
  using ingest.py in Docker. Automates all months with ForEach.

tasks:

  # ----------------------
  # Green taxi
  # ----------------------
  - id: green-taxi-loop
    type: io.kestra.core.tasks.flows.ForEach
    items:
      - [2021, 1]
      - [2021, 2]
      - [2021, 3]
      - [2021, 4]
      - [2021, 5]
      - [2021, 6]
      - [2021, 7]
    task:
      id: ingest-green-month
      type: io.kestra.core.tasks.scripts.Bash
      command: |
        docker run --rm \
          --network docker-sql-pipeline_default \
          -v /workspaces/data-engineering/docker-sql-pipeline:/app \
          -w /app \
          python:3.13 \
          bash -c "pip install -r requirements.txt && python ingest.py --year {{item.0}} --month {{item.1}} --table green_taxi_data"

  # ----------------------
  # Yellow taxi
  # ----------------------
  - id: yellow-taxi-loop
    type: io.kestra.core.tasks.flows.ForEach
    items:
      - [2021, 1]
      - [2021, 2]
      - [2021, 3]
      - [2021, 4]
      - [2021, 5]
      - [2021, 6]
      - [2021, 7]
    task:
      id: ingest-yellow-month
      type: io.kestra.core.tasks.scripts.Bash
      command: |
        docker run --rm \
          --network docker-sql-pipeline_default \
          -v /workspaces/data-engineering/docker-sql-pipeline:/app \
          -w /app \
          python:3.13 \
          bash -c "pip install -r requirements.txt && python ingest.py --year {{item.0}} --month {{item.1}} --table yellow_taxi_data"
